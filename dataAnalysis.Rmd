---
title: "EVOSTC data collection paper - Analysis"
author: "Jessica Couture"
date: "5/31/2016"# started: "9/27/2015"
output: html_document
---

#Background

We are writing up a publication to report results of a two year data archiving effort by a small group of researchers and students at the National Center for Ecological Analysis and Synthesis at UC Santa Barbara. The [Exxon Valdez Oil Spill Trustee Council](http://www.evostc.state.ak.us) (EVOSTC) was formed following the Exon Valdez oil spill in Alaska in 1989. Since then, the EVOSTC has funded hundreds of projects and in 2012 we initiated an effort to recover and archive the data collected in these EVOSTC funded projects.

For this paper we ask 4 main questions about the data collected from the Exxon Valdez Oil Spill Trustee Council funded projects:

1. Twenty-five years after the EVOS, for how many projects funded by EVOSTC can we collect data?
2. Are there certain **research fields** that are more likely to make data available than others?
3. Are there certain **sectors** that are more likely to make data available than others?
4. Is the availability of data correlated to how old the data are? (temporal relationships?)


```{r data prep,echo=FALSE,message=FALSE}

library(knitr)
library(dplyr)
library(readr)
library(ggplot2)
library(reshape2)
library(grid)
library(gridExtra)

rslt=read.csv('data/archResRevised2.csv',header=T,stringsAsFactors=F)
rslt[rslt$Status=='published','Status']<-'Published'

rslt$succ=ifelse(rslt$Status %in% c('Published','SentData','Revised'),0,1) # 0=success???
rslt$statSucc=ifelse(rslt$Status %in% c('Published','SentData','Revised'),1,0) # 1 = success, 2 = not successful


agDes=read.csv('data/ecoInfoAgencyDesig.csv',header=T,stringsAsFactors=T,col.names=c('agency','agGrp','agSubGrp'))
agDes$agGrp=gsub('nonProf','private',agDes$agGrp)


rslt2=merge(rslt,agDes,all.x=T)
rslt2=rslt2 %>%
  filter(!end>2010) %>%
  select(Status,start,end,ecosystem,dataType,statSucc,agGrp,agSubGrp,reason)

head(rslt2)
```

# 1. Project Status Reporting
<h4>Twenty-five years after the EVOS, for how many projects funded by EVOSTC can we collect data?</h4>
 


### Test for equal proportions between status categories:
Are the proportion of projects in each category equal? --> chi-squared test


Limitations of the Chi-Square Test: 

* The chi-square test does not give us much information about the strength of the relationship or its substantive significance in the population.
* The chi-square test is sensitive to sample size. The size of the calculated chi-square is directly proportional to the size of the sample, independent of the strength of the relationship between the variables.
* The chi-square test is also sensitive to small expected frequencies in one or more of the cells in the table. 

I feel like these are things that we have always been aware of and in our don't create any false significance...opinions? Social data?

```{r chi squared - test for eq prop,echo=FALSE}
statusProps=table(rslt2$Status)
eqProp=chisq.test(statusProps) #not equal proportions

eqProp
```
__Proportions are NOT equal between status groups__

***

### Binomial logistic regression: ALL data
Which elements contribute most in determining if the data will be successfully collected?

* research field
* research sector of project PI
* year project recieved its last year of EVOSTC funding

```{r BLM - allGen}
splBio=strsplit(rslt2$dataType,'-')
rslt3<-rslt2 %>%
  mutate(dtGen=sapply(splBio,function(x) x[1]))

succBlrGen<-glm(formula = statSucc~agSubGrp+end+dtGen,family='binomial',data=rslt3)

## statSucc = Binomial: did we recover the data?
## agGrp = sector of home institution
## end = last year project was funded by EVOSTC
## dtgeb = general field of study (bio grouped)

summary(succBlrGen)

```

```{r BLM - allBioSep}

succBlrBio<-glm(formula = statSucc~agSubGrp+end+dataType,family='binomial',data=rslt2)

## statSucc = Binomial: did we recover the data?
## agGrp = sector of home institution
## end = last year project was funded by EVOSTC
## dataType = field of study (bio ungrouped)

summary(succBlrBio)

```
__Only categories with low success rates are sginificant ("low"" is <20%): fish data and social data__

Potential explanations:

* Fish: Culture around protecting fishing locations and catches
* Social: formats of data collection and storage diffcult to share

__THESE RESULTS CHANGE WHEN I CHANGE THE ORDER OF FACTORS__

***

# 2. Data type category

### Are there certain **research fields** that are more likely to make data available than others?

### Test for equal proportions between categories:

Chi-squared test for equal proportions between research fields funded

```{r chi squared - field of study,echo=FALSE,warning=FALSE}

dtProps=table(rslt2$statSucc,rslt2$dataType)
dtChi=chisq.test(dtProps)

dtChi
```

***

# 3. Research sector type

### Are there certain **sectors** that are more likely to make data available than others?
(based on PI's affiliation)

#### Test for equal propportions between PI's home institution type/sector: 

government and private grouped
```{r chi squared - sector,echo=FALSE,warning=FALSE}
secProps=table(rslt2$statSucc,rslt2$agGrp)
sectChi=chisq.test(secProps)

sectChi
```

#### Test for equal propportions between PI's home institution type/sector:

government and private split: govFed, govState, nonProf, forProf
```{r chi squared - subSector,echo=FALSE,warning=FALSE}
subSecProps=table(rslt2$statSucc,rslt2$agSubGrp)
subSectChi=chisq.test(subSecProps)

subSectChi
```
__NOT SIGNIFICANT: neither sectors nor subsectors are significant__

***

# 4. Temporal relationships

### Is the availability of data correlated to how old the data are?

#### Test for equal proportions between categories:

Chi-squared test for equal proportions between age of data

```{r chi squared - end years,echo=FALSE,warning=FALSE}

tempProps=table(rslt2$statSucc,as.character(rslt2$end))
tempChi=chisq.test(tempProps)

tempChi
```

***

# 5. Why don't people share data?

### Do we need stats here?

```{r data prep - reasons,echo=FALSE,warning=FALSE}

reas=rslt2 %>%
  filter(Status=='Unrecoverable') %>%
  filter(!reason=="no data generated") %>%
  filter(!reason=="data uvailable") %>%
  select(Status,reason)
reasTab=as.data.frame(table(reas$reason))
colnames(reasTab)=c('reason','nDatasets')

## add in status = 'emailed' to 'no contact info' & status = "replied" to unwilling to share? ...discuss with group

reasTab[reasTab$reason=='no contact info',"nDatasets"] <- (reasTab[reasTab$reason=='no contact info',"nDatasets"] + length(rslt2[rslt2$Status=='Emailed','Status'])) 

levels(reasTab$reason)=c(levels(reasTab$reason),'communication lost')

reasTab[6,]<-c('communication lost', length(rslt2[rslt2$Status=='Replied','Status'])+1)# +1 for one of the 'data unavailable' datasets, add the other to "data lost"
reasTab[1,2]<-as.numeric(as.character(reasTab[reasTab$reason=="data lost","nDatasets"]))+1

reasTab<-arrange(reasTab,desc(as.numeric(nDatasets)))
reasTab$reason<-factor(reasTab$reason,levels = reasTab$reason,ordered = T)

```


```{r whyNot, echo=F}

whyNot<-ggplot(reasTab,aes(x=reason,y=as.numeric(nDatasets)))+
  geom_bar(stat = "identity")+
  theme(axis.line=element_line('black'),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())+
  theme(axis.text.x = element_text(angle=90))+
  #xlab('\nReason data were not recovered')+
  ylab('Number of Projects\n')+
  #ggtitle('Why are data not recovered?')+
  theme(axis.text=element_text(size=14),
        title=element_text(size=16,face="bold"))+
  theme(axis.line.x = element_line(color="black"),
        axis.line.y = element_line(color="black")) ## *** add each n as text above bar
whyNot
```

